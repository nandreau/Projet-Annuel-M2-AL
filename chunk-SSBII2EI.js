import{a as _e}from"./chunk-XDNR7TPJ.js";import{a as ue}from"./chunk-JMWMRI7M.js";import{a as me}from"./chunk-X5X5ECOX.js";import{B as ce,D as N,e as j,f as ee,g as O,i as te,j as ie,l as ne,o as ae,p as oe,q as re,u as le,w as se,x as de,y as pe}from"./chunk-BGEFYTHM.js";import{a as B}from"./chunk-SWGHULUR.js";import"./chunk-AVJKP4BS.js";import{Ib as L,J as Y,W as Z,mb as $}from"./chunk-JUQHIW5V.js";import{B as J,E as K,H as X,M as W,l as F,m as P,q as D,s as G}from"./chunk-DCZ4DVFQ.js";import"./chunk-F2X3VGZZ.js";import{Ab as r,Bb as o,Cb as v,Gb as g,Lb as _,Mb as l,Oa as z,Ra as s,Rb as U,Sb as Q,Tb as R,Wa as w,Xb as u,Yb as I,Zb as S,ac as h,bc as k,cc as x,db as E,ea as c,ec as b,fa as m,jb as f,na as q,oc as T,q as C,qc as M,rb as d,ub as A}from"./chunk-SDAJZUUB.js";import"./chunk-K52QYQVA.js";import"./chunk-7KGURMOZ.js";import"./chunk-I4GAAI6Y.js";import"./chunk-T6YKWIIR.js";import"./chunk-VBESZKOS.js";import"./chunk-4BZVYRZJ.js";import"./chunk-BNWIWOXL.js";import"./chunk-4U6PRYVA.js";import"./chunk-DLZWFDKZ.js";import"./chunk-JWIEPCRG.js";import"./chunk-C5RQ2IC2.js";import"./chunk-D4VGNZLR.js";import"./chunk-JHLW7V75.js";import"./chunk-SV7S5NYR.js";import{a as H,k as y}from"./chunk-OWF7QSRQ.js";var we=()=>({width:"40rem"}),be=()=>({width:"35rem"});function Te(a,p){if(a&1&&(r(0,"div",18),v(1,"img",19),o()),a&2){let i=p.$implicit;s(),d("src",i,z)}}function Me(a,p){if(a&1){let i=g();r(0,"p-button",25),_("click",function(){c(i);let e=l().$implicit,n=l(2);return m(n.deleteChecklistItem(e))}),o()}a&2&&d("rounded",!0)}function Se(a,p){if(a&1){let i=g();r(0,"div",20)(1,"p-checkbox",21),x("ngModelChange",function(e){let n=c(i).$implicit;return k(n.done,e)||(n.done=e),m(e)}),_("onChange",function(){let e=c(i).$implicit,n=l(2);return m(n.onChecklistChange(e))}),o(),r(2,"input",22),x("ngModelChange",function(e){let n=c(i).$implicit;return k(n.name,e)||(n.name=e),m(e)}),_("blur",function(){let e=c(i).$implicit,n=l(2);return m(n.onChecklistChange(e))}),o(),r(3,"div",23),u(4),T(5,"date"),o(),f(6,Me,1,1,"p-button",24),o()}if(a&2){let i=p.$implicit,t=l(2);s(),d("readonly",t.task.done),h("ngModel",i.done),s(),d("variant",t.task.done?"filled":"outlined")("disabled",t.task.done),h("ngModel",i.name),s(2),S(" ",M(5,7,i.updatedAt,"d MMMM y HH:mm")," "),s(2),d("ngIf",!t.task.done)}}function Ve(a,p){if(a&1){let i=g();r(0,"div",26)(1,"input",27),x("ngModelChange",function(e){c(i);let n=l(2);return k(n.newItemName,e)||(n.newItemName=e),m(e)}),_("keydown.enter",function(){c(i);let e=l(2);return m(e.addChecklistItem())}),o(),r(2,"p-button",28),_("click",function(){c(i);let e=l(2);return m(e.addChecklistItem())}),o()()}if(a&2){let i=l(2);s(),h("ngModel",i.newItemName),s(),d("rounded",!0)}}function Ee(a,p){if(a&1){let i=g();r(0,"div",29)(1,"p-button",30),_("click",function(){c(i);let e=l(2);return m(e.confirmation=!0)}),o()()}}function Ie(a,p){if(a&1){let i=g();r(0,"p-dialog",1),x("visibleChange",function(e){c(i);let n=l();return k(n.visible,e)||(n.visible=e),m(e)}),_("onHide",function(){c(i);let e=l();return m(e.closed.emit())}),r(1,"div",2)(2,"span",3),u(3),o(),r(4,"input",4),x("ngModelChange",function(e){c(i);let n=l();return k(n.task.name,e)||(n.task.name=e),m(e)}),_("blur",function(){c(i);let e=l();return m(e.onFieldChange("name",e.task.name))}),o()(),r(5,"div",5),f(6,Te,2,1,"div",6),o(),r(7,"div",5)(8,"div",7)(9,"div",8),u(10,"Priorit\xE9"),o(),r(11,"p-select",9),x("ngModelChange",function(e){c(i);let n=l();return k(n.task.priority,e)||(n.task.priority=e),m(e)}),_("onChange",function(){c(i);let e=l();return m(e.onFieldChange("priority",e.task.priority))}),o()(),r(12,"div",10)(13,"div",8),u(14,"Date d\u2019\xE9ch\xE9ance"),o(),r(15,"p-datePicker",11),T(16,"date"),x("ngModelChange",function(e){c(i);let n=l();return k(n.task.dueDate,e)||(n.task.dueDate=e),m(e)}),_("onSelect",function(){c(i);let e=l();return m(e.onFieldChange("dueDate",e.task.dueDate))}),o()(),r(17,"div",12)(18,"div",8),u(19,"Description"),o(),r(20,"textarea",13),x("ngModelChange",function(e){c(i);let n=l();return k(n.task.description,e)||(n.task.description=e),m(e)}),_("blur",function(){c(i);let e=l();return m(e.onFieldChange("description",e.task.description))}),o()(),r(21,"div",12)(22,"div",8),u(23,"Liste de contr\xF4le"),o(),r(24,"div",14),f(25,Se,7,10,"div",15)(26,Ve,3,2,"div",16),o()()(),f(27,Ee,2,0,"div",17),o()}if(a&2){let i,t=l();A(b(26,we)),h("visible",t.visible),d("modal",!0),s(3),S(" ",t.utils.getTaskState(t.task)+":","\xA0 "),s(),d("disabled",t.task.done),h("ngModel",t.task.name),s(2),d("ngForOf",t.task.images),s(5),d("variant",t.task.done?"filled":"outlined")("disabled",t.task.done)("options",t.priorityOptions),h("ngModel",t.task.priority),s(4),d("variant",t.task.done?"filled":"outlined")("disabled",t.task.done),h("ngModel",t.task.dueDate),d("placeholder",(i=M(16,23,t.task.dueDate,"d MMMM y"))!==null&&i!==void 0?i:"Pas d\u2019\xE9ch\xE9ance")("showButtonBar",!0),s(5),d("variant",t.task.done?"filled":"outlined")("disabled",t.task.done),h("ngModel",t.task.description),s(5),d("ngForOf",t.task.checklists),s(),d("ngIf",!t.task.done),s(),d("ngIf",!t.task.done)}}function Fe(a,p){a&1&&(r(0,"div",37),u(1," \u26A0\uFE0F Au moins une image de preuve de r\xE9alisation de la t\xE2che est requise pour la valider. "),o())}function Pe(a,p){if(a&1){let i=g();r(0,"p-dialog",1),x("visibleChange",function(e){c(i);let n=l();return k(n.visible,e)||(n.visible=e),m(e)}),_("onHide",function(){c(i);let e=l();return m(e.closed.emit())}),r(1,"p",31),u(2,"Voulez vous valider cette t\xE2che ?"),o(),r(3,"app-image-manager",32),x("imagesChange",function(e){c(i);let n=l();return k(n.imageList,e)||(n.imageList=e),m(e)}),o(),f(4,Fe,2,0,"div",33),r(5,"div",34)(6,"button",35),_("click",function(){c(i);let e=l();return m(e.confirmation=!1)}),o(),r(7,"p-button",36),_("click",function(){c(i);let e=l();return m(e.onValidate())}),o()()()}if(a&2){let i=l();A(b(6,be)),h("visible",i.visible),d("modal",!0),s(3),h("images",i.imageList),s(),d("ngIf",i.imageList.length===0)}}var ge=(()=>{let p=class p{constructor(t,e){this.request=t,this.utils=e,this.visible=!1,this.phases=[],this.submitted=new q,this.closed=new q,this.progressionOptions=[{label:"Non d\xE9marr\xE9es",value:"\xC0 faire"},{label:"En cours",value:"En cours"},{label:"Termin\xE9e",value:"Termin\xE9e"},{label:"En retard",value:"En retard"}],this.priorityOptions=[{label:"Urgent",value:"Urgent"},{label:"Important",value:"Important"},{label:"Moyen",value:"Moyen"},{label:"Faible",value:"Faible"}],this.newItemName="",this.confirmation=!1,this.imageList=[]}onFieldChange(t,e){return y(this,null,function*(){try{let n=yield C(this.request.put(`api/tasks/${this.task.id}/meta`,{[t]:e},!1));this.task=n.data}catch(n){console.error("Erreur mise \xE0 jour t\xE2che",n)}})}addChecklistItem(){return y(this,null,function*(){let t=this.newItemName.trim();if(t)try{let e=yield C(this.request.post("api/checklist",{taskId:this.task.id,name:t},!1));this.task.checklists=[...this.task.checklists||[],e.data],this.newItemName=""}catch(e){console.error("Erreur cr\xE9ation checklist item",e)}})}onChecklistChange(t){return y(this,null,function*(){try{let e=yield C(this.request.put(`api/checklist/${t.id}`,{name:t.name,done:t.done},!1));this.task.checklists=this.task.checklists.map(n=>n.id===e.id?e:n)}catch(e){console.error("Erreur mise \xE0 jour checklist item",e)}})}deleteChecklistItem(t){return y(this,null,function*(){try{yield C(this.request.delete(`api/checklist/${t.id}`,!1)),this.task.checklists=this.task.checklists.filter(e=>e.id!==t.id)}catch(e){console.error("Erreur suppression checklist item",e)}})}onValidate(){return y(this,null,function*(){try{if(this.imageList.length===0){console.warn("At least one image is required");return}let t=yield C(this.request.put(`api/tasks/${this.task.id}/validate`,{images:[...this.imageList]},!0));this.task=t.data,this.submitted.emit(t.data)}catch(t){console.error("Erreur validation t\xE2che",t)}})}};p.\u0275fac=function(e){return new(e||p)(w(L),w(B))},p.\u0275cmp=E({type:p,selectors:[["app-task-modal"]],inputs:{visible:"visible",task:"task",phases:"phases"},outputs:{submitted:"submitted",closed:"closed"},decls:2,vars:2,consts:[["header","D\xE9tails de la t\xE2che","appendTo","body",3,"visible","modal","style","visibleChange","onHide",4,"ngIf"],["header","D\xE9tails de la t\xE2che","appendTo","body",3,"visibleChange","onHide","visible","modal"],[1,"flex","align-items-center","mb-2"],[1,"white-space-nowrap","font-bold"],["pInputText","","tab","",1,"raw-input",3,"ngModelChange","blur","disabled","ngModel"],[1,"grid","mt-2"],["class","col-6 sm:col-4",4,"ngFor","ngForOf"],[1,"col-6"],[1,"font-bold","text-sm","mb-2"],["inputId","priority","placeholder","Priorit\xE9",1,"w-full",3,"ngModelChange","onChange","variant","disabled","options","ngModel"],[1,"field","col-6"],["inputId","due","dateFormat","dd/mm/yy","showIcon","","appendTo","body",1,"w-full",3,"ngModelChange","onSelect","variant","disabled","ngModel","placeholder","showButtonBar"],[1,"field","col-12"],["id","desc","pInputTextarea","","rows","4","placeholder","Ajoutez des notes ici...",1,"w-full",3,"ngModelChange","blur","variant","disabled","ngModel"],[1,"checklist"],["class","checklist-item flex align-items-center mb-2",4,"ngFor","ngForOf"],["class","flex align-items-center",4,"ngIf"],["class","flex justify-content-end gap-2 mt-2",4,"ngIf"],[1,"col-6","sm:col-4"],[1,"border-round-md","object-cover","rounded",3,"src"],[1,"checklist-item","flex","align-items-center","mb-2"],["binary","true",3,"ngModelChange","onChange","readonly","ngModel"],["pInputText","","pSize","small",1,"ml-2","raw-input",3,"ngModelChange","blur","variant","disabled","ngModel"],[1,"text-xs","white-space-nowrap","text-400"],["icon","pi pi-times","variant","text","size","small","severity","secondary","class","ml-2","title","Supprimer",3,"rounded","click",4,"ngIf"],["icon","pi pi-times","variant","text","size","small","severity","secondary","title","Supprimer",1,"ml-2",3,"click","rounded"],[1,"flex","align-items-center"],["pInputText","","pSize","small","placeholder","Ajouter un \xE9l\xE9ment",1,"flex-grow-1",3,"ngModelChange","keydown.enter","ngModel"],["icon","pi pi-plus","size","small","title","Ajouter",1,"ml-2",3,"click","rounded"],[1,"flex","justify-content-end","gap-2","mt-2"],["label","Valider la t\xE2che","severity","success",3,"click"],[1,"mt-1","mb-5"],[3,"imagesChange","images"],["class","text-red-500 mt-2",4,"ngIf"],[1,"flex","justify-content-end","gap-2","mt-5"],["pButton","","type","button","label","Annuler","severity","secondary",3,"click"],["label","Valider",3,"click"],[1,"text-red-500","mt-2"]],template:function(e,n){e&1&&f(0,Ie,28,27,"p-dialog",0)(1,Pe,8,7,"p-dialog",0),e&2&&(d("ngIf",!n.confirmation),s(),d("ngIf",n.confirmation))},dependencies:[W,J,K,X,G,F,P,D,N,ee,O,te,ie,ne,re,j,le,_e],styles:[".raw-input[_ngcontent-%COMP%]{border:none;box-shadow:none;padding-left:0;background:none!important}"]});let a=p;return a})();var De=["dt"],We=()=>[10,25,50],Be=()=>[];function Le(a,p){if(a&1){let i=g();r(0,"div",12)(1,"p-iconField",13)(2,"p-inputIcon"),v(3,"i",14),o(),r(4,"input",15),_("input",function(e){c(i);let n=l();return m(n.applyGlobalFilter(e))}),o()()()}}function je(a,p){if(a&1&&(r(0,"th",17),u(1),v(2,"p-sortIcon",18),o()),a&2){let i=p.$implicit;d("pSortableColumn",i.field),s(),S(" ",i.header," "),s(),d("field",i.field)}}function Oe(a,p){if(a&1&&(r(0,"tr"),f(1,je,3,3,"th",16),v(2,"th"),o()),a&2){let i=l();s(),d("ngForOf",i.columns)}}function Ne(a,p){if(a&1){let i=g();r(0,"tr")(1,"td"),u(2),o(),r(3,"td"),v(4,"p-tag",19),o(),r(5,"td"),v(6,"p-tag",19),o(),r(7,"td"),u(8),T(9,"date"),o(),r(10,"td"),u(11),T(12,"date"),o(),r(13,"td")(14,"p-button",20),_("click",function(){let e=c(i).$implicit,n=l();return m(n.openEdit(e))}),o()()()}if(a&2){let i=p.$implicit,t=l();s(2),I(i.name),s(2),d("value",i.priority)("severity",t.utils.getPrioritySeverity(i.priority)),s(2),d("value",t.utils.getTaskState(i))("severity",t.utils.getTaskSeverity(i)),s(2),I(M(9,8,i.doneDate,"yyyy-MM-dd")||"\u2014"),s(3),I(M(12,11,i.dueDate,"yyyy-MM-dd")),s(3),d("rounded",!0)}}function qe(a,p){a&1&&(r(0,"tr")(1,"td",21),u(2,"Aucune t\xE2che trouv\xE9e"),o()())}function Ae(a,p){if(a&1){let i=g();r(0,"app-task-modal",22),_("closed",function(){c(i);let e=l();return m(e.visibleDetail=!1)})("submitted",function(e){c(i);let n=l();return m(n.onDetailSave(e))}),o()}if(a&2){let i=l();d("visible",i.visibleDetail)("task",i.selectedTask)("phases",b(3,Be))}}var xt=(()=>{let p=class p{constructor(t,e,n){this.tableService=t,this.request=e,this.utils=n,this.tasks=[],this.initialValues=[],this.isSorted=null,this.visibleDetail=!1}ngOnInit(){return y(this,null,function*(){yield this.loadTasks(),this.defineFields()})}loadTasks(){return C(this.request.get("api/tasks")).then(t=>{this.tasks=t,this.initialValues=[...t]}).catch(t=>{console.error("Erreur chargement t\xE2ches",t)})}defineFields(){this.columns=[{field:"name",header:"Nom"},{field:"priority",header:"Priorit\xE9"},{field:"done",header:"\xC9tat"},{field:"doneDate",header:"Termin\xE9 le"},{field:"dueDate",header:"Fin pr\xE9vue"}],this.globalFilterFields=this.columns.map(t=>t.field)}applyGlobalFilter(t){let e=t.target.value;this.tableService.applyGlobalFilter(this.dt,e)}customSort(t){this.isSorted=this.tableService.customSort(t,this.tasks,this.initialValues,this.isSorted,this.dt)}openEdit(t){this.selectedTask=H({},t),this.visibleDetail=!0}onDetailClose(){this.visibleDetail=!1}onDetailSave(t){return y(this,null,function*(){yield this.loadTasks(),this.visibleDetail=!1})}};p.\u0275fac=function(e){return new(e||p)(w(ue),w(L),w(B))},p.\u0275cmp=E({type:p,selectors:[["app-tasks"]],viewQuery:function(e,n){if(e&1&&U(De,5),e&2){let V;Q(V=R())&&(n.dt=V.first)}},decls:14,vars:9,consts:[["dt",""],[3,"fullscreen"],[1,"container"],[1,"header-container","flex","justify-content-between","align-items-center"],[1,"header-container-title"],[1,"form"],["styleClass","p-datatable-gridlines",3,"sortFunction","value","paginator","rows","rowsPerPageOptions","globalFilterFields","customSort"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visible","task","phases","closed","submitted",4,"ngIf"],[1,"flex","justify-content-end"],["iconPosition","left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher une t\xE2che",3,"input"],[3,"pSortableColumn",4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[3,"value","severity"],["variant","text","icon","pi pi-pencil","title","Modifier",3,"click","rounded"],["colspan","6"],[3,"closed","submitted","visible","task","phases"]],template:function(e,n){if(e&1){let V=g();v(0,"app-header"),r(1,"ion-content",1)(2,"div",2)(3,"div",3)(4,"div",4),u(5,"Liste des t\xE2ches"),o()(),r(6,"div",5)(7,"p-table",6,0),_("sortFunction",function(fe){return c(V),m(n.customSort(fe))}),f(9,Le,5,0,"ng-template",7)(10,Oe,3,1,"ng-template",8)(11,Ne,15,14,"ng-template",9)(12,qe,3,0,"ng-template",10),o()()(),f(13,Ae,1,4,"app-task-modal",11),o()}e&2&&(s(),d("fullscreen",!0),s(6),d("value",n.tasks)("paginator",!0)("rows",10)("rowsPerPageOptions",b(8,We))("globalFilterFields",n.globalFilterFields)("customSort",!0),s(6),d("ngIf",n.visibleDetail))},dependencies:[Z,Y,N,$,O,F,P,j,se,de,pe,ce,ae,oe,D,me,W,ge],encapsulation:2});let a=p;return a})();export{xt as TasksPage};
