import{a as se}from"./chunk-JMWMRI7M.js";import{a as re,b as ne}from"./chunk-LAXIKTFX.js";import{a as le}from"./chunk-X5X5ECOX.js";import{A as ee,B as te,D as ie,e as N,g as W,o as $,p as K,w as J,x as X,y as Y,z as Z}from"./chunk-BGEFYTHM.js";import"./chunk-AVJKP4BS.js";import{Ib as L,J as Q,W as B,mb as G}from"./chunk-JUQHIW5V.js";import{M as z,l as O,q as H}from"./chunk-DCZ4DVFQ.js";import"./chunk-F2X3VGZZ.js";import{Ab as l,Bb as r,Cb as c,Gb as A,Lb as f,Mb as v,Pb as P,Ra as o,Rb as x,Sb as U,Tb as I,Wa as F,Xb as _,Yb as V,_b as k,ac as M,bc as D,cc as j,db as C,ea as m,ec as T,fa as p,jb as E,oc as R,q as g,qc as q,rb as d}from"./chunk-SDAJZUUB.js";import"./chunk-K52QYQVA.js";import"./chunk-7KGURMOZ.js";import"./chunk-I4GAAI6Y.js";import"./chunk-T6YKWIIR.js";import"./chunk-VBESZKOS.js";import"./chunk-4BZVYRZJ.js";import"./chunk-BNWIWOXL.js";import"./chunk-4U6PRYVA.js";import"./chunk-DLZWFDKZ.js";import"./chunk-JWIEPCRG.js";import"./chunk-C5RQ2IC2.js";import"./chunk-D4VGNZLR.js";import"./chunk-JHLW7V75.js";import"./chunk-SV7S5NYR.js";import{a as y,b as S,k as w}from"./chunk-OWF7QSRQ.js";var ae=["dt"],oe=()=>[10,25,50],de=()=>["name","email","rolesString","job"];function me(s,a){if(s&1){let n=A();l(0,"div",14)(1,"div",15)(2,"p-button",16),f("click",function(){m(n);let t=v();return p(t.openAdd())}),r(),l(3,"p-button",17),f("click",function(){m(n);let t=v();return p(t.openEdit())}),r(),l(4,"p-button",18),f("click",function(){m(n);let t=v();return p(t.openDelete())}),r()(),l(5,"p-iconField",19)(6,"p-inputIcon"),c(7,"i",20),r(),l(8,"input",21),f("input",function(t){m(n);let i=v();return p(i.applyGlobalFilter(t))}),r()()()}if(s&2){let n=v();o(3),d("disabled",!n.selectedUsers.length||n.selectedUsers.length>1),o(),d("disabled",!n.selectedUsers.length),o(4),d("disabled",n.visibleAdd||n.visibleEdit||n.visibleDelete)}}function pe(s,a){s&1&&(l(0,"tr")(1,"th",22),c(2,"p-tableHeaderCheckbox"),r(),l(3,"th",23),_(4," Nom pr\xE9nom "),c(5,"p-sortIcon",24),r(),l(6,"th",25),_(7,"Email "),c(8,"p-sortIcon",26),r(),l(9,"th",27),_(10," Adh\xE9rent "),c(11,"p-sortIcon",28),r(),l(12,"th",29),_(13,"R\xF4le "),c(14,"p-sortIcon",30),r(),l(15,"th",31),_(16,"M\xE9tier "),c(17,"p-sortIcon",32),r()())}function ce(s,a){if(s&1&&c(0,"p-tag",35),s&2){let n=a.$implicit;d("value",n.name)}}function ue(s,a){if(s&1&&c(0,"p-tag",35),s&2){let n=a.$implicit;d("value",n)}}function _e(s,a){if(s&1&&(l(0,"tr")(1,"td"),c(2,"p-tableCheckbox",33),r(),l(3,"td"),_(4),r(),l(5,"td"),_(6),r(),l(7,"td"),_(8),R(9,"date"),r(),l(10,"td"),E(11,ce,1,1,"p-tag",34),r(),l(12,"td"),E(13,ue,1,1,"p-tag",34),r()()),s&2){let n=a.$implicit;o(2),d("value",n),o(2),k("",n.firstname," ",n.name,""),o(2),V(n.email),o(2),V(q(9,7,n.createdAt,"d MMMM y HH:mm")),o(3),d("ngForOf",n.roles),o(2),d("ngForOf",n.job)}}function he(s,a){s&1&&(l(0,"tr")(1,"td",36),_(2,"Aucun utilisateur trouv\xE9"),r()())}var De=(()=>{let a=class a{constructor(e,t){this.tableService=e,this.request=t,this.users=[],this.availableRoles=[],this.selectedUsers=[],this.initialValues=[],this.isSorted=null,this.visibleAdd=!1,this.visibleEdit=!1,this.visibleDelete=!1,this.allFields=[],this.addFields=[],this.editFields=[],this.resetUserForm()}ngOnInit(){return w(this,null,function*(){yield this.loadRoles(),yield this.loadUsers(),this.defineFields()})}loadUsers(){return this.selectedUsers=[],g(this.request.get("api/users")).then(e=>{this.users=e.map(t=>S(y({},t),{rolesString:t.roles.map(i=>i.name).join(" ")})),this.initialValues=[...this.users]}).catch(e=>{console.error("Erreur chargement utilisateurs",e)})}loadRoles(){return g(this.request.get("api/roles")).then(e=>{this.availableRoles=e}).catch(e=>{console.error("Erreur chargement roles",e)})}defineFields(){this.allFields=[{key:"firstname",label:"Pr\xE9nom",type:"text",placeholder:""},{key:"name",label:"Nom",type:"text",placeholder:""},{key:"roles",label:"R\xF4les",type:"multiselect",options:this.availableRoles,optionLabel:"name",placeholder:"S\xE9lectionner des r\xF4les"},{key:"job",label:"M\xE9tier",type:"chips",placeholder:"Ajouter un m\xE9tier"},{key:"email",label:"Email",type:"email",placeholder:""},{key:"password",label:"Mot de passe",type:"password",placeholder:""}],this.addFields=[...this.allFields],this.editFields=this.allFields.filter(e=>e.key!=="password")}applyGlobalFilter(e){let t=e.target.value;this.tableService.applyGlobalFilter(this.dt,t)}customSort(e){this.isSorted=this.tableService.customSort(e,this.users,this.initialValues,this.isSorted,this.dt)}openAdd(){this.resetUserForm(),this.visibleAdd=!0}openEdit(){this.selectedUsers.length===1&&(this.userForm=y({},this.selectedUsers[0]),this.visibleEdit=!0)}openDelete(){this.selectedUsers.length>0&&(this.visibleDelete=!0)}handleAdd(e){return w(this,null,function*(){yield g(this.request.post("api/users",S(y({},e),{roles:e.roles.map(t=>t.name)}),!0)),this.visibleAdd=!1,yield this.loadUsers()})}handleEdit(e){return w(this,null,function*(){yield g(this.request.put(`api/users/${e.id}`,S(y({},e),{roles:e.roles.map(t=>t.name)}),!0)),this.visibleEdit=!1,yield this.loadUsers()})}handleDelete(){return w(this,null,function*(){yield Promise.all(this.selectedUsers.map(e=>g(this.request.delete(`api/users/${e.id}`,!0)))),this.visibleDelete=!1,yield this.loadUsers()})}resetUserForm(){this.userForm={id:0,firstname:"",name:"",email:"",password:"",roles:[],job:[],avatar:""}}};a.\u0275fac=function(t){return new(t||a)(F(se),F(L))},a.\u0275cmp=C({type:a,selectors:[["app-admin"]],viewQuery:function(t,i){if(t&1&&x(ae,5),t&2){let u;U(u=I())&&(i.dt=u.first)}},decls:16,vars:19,consts:[["dt",""],[3,"fullscreen"],[1,"container"],[1,"header-container"],[1,"header-container-title"],[1,"form"],["dataKey","id","styleClass","p-datatable-gridlines",3,"selectionChange","sortFunction","value","rows","paginator","rowsPerPageOptions","globalFilterFields","selection","customSort"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["mode","add","subtitle","Veuillez remplir les informations de l'utilisateur.",3,"submitted","closed","visible","model","fields"],["mode","edit","subtitle","Modifier les informations de l'utilisateur s\xE9lectionn\xE9.",3,"submitted","closed","visible","model","fields"],["header","Supprimer Utilisateurs","color","danger",3,"submitted","closed","visible","subtitle"],[1,"flex","gap-2","align-items-center","justify-content-between"],[1,"flex","column-gap-2"],["label","Ajouter","icon","pi pi-plus","severity","success","size","small",3,"click"],["label","Modifier","icon","pi pi-pencil","severity","warn","size","small",3,"click","disabled"],["label","Supprimer","icon","pi pi-trash","severity","danger","size","small",3,"click","disabled"],["iconPosition","left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher un utilisateur",3,"input","disabled"],[2,"width","3rem"],["pSortableColumn","name"],["field","name"],["pSortableColumn","mail"],["field","mail"],["pSortableColumn","createdAt"],["field","createdAt"],["pSortableColumn","roles"],["field","role"],["pSortableColumn","job"],["field","job"],[3,"value"],["class","mr-3","rounded","true",3,"value",4,"ngFor","ngForOf"],["rounded","true",1,"mr-3",3,"value"],["colspan","6"]],template:function(t,i){if(t&1){let u=A();c(0,"app-header"),l(1,"ion-content",1)(2,"div",2)(3,"div",3)(4,"div",4),_(5,"Liste des Utilisateurs"),r()(),l(6,"div",5)(7,"p-table",6,0),j("selectionChange",function(h){return m(u),D(i.selectedUsers,h)||(i.selectedUsers=h),p(h)}),f("sortFunction",function(h){return m(u),p(i.customSort(h))}),E(9,me,9,3,"ng-template",7)(10,pe,18,0,"ng-template",8)(11,_e,14,10,"ng-template",9)(12,he,3,0,"ng-template",10),r()()(),l(13,"app-dynamic-form-modal",11),f("submitted",function(h){return m(u),p(i.handleAdd(h))})("closed",function(){return m(u),p(i.visibleAdd=!1)}),r(),l(14,"app-dynamic-form-modal",12),f("submitted",function(h){return m(u),p(i.handleEdit(h))})("closed",function(){return m(u),p(i.visibleEdit=!1)}),r(),l(15,"app-confirm-modal",13),f("submitted",function(){return m(u),p(i.handleDelete())})("closed",function(){return m(u),p(i.visibleDelete=!1)}),r()()}t&2&&(o(),d("fullscreen",!0),o(6),d("value",i.users)("rows",10)("paginator",!0)("rowsPerPageOptions",T(17,oe))("globalFilterFields",T(18,de)),M("selection",i.selectedUsers),d("customSort",!0),o(6),d("visible",i.visibleAdd)("model",i.userForm)("fields",i.addFields),o(),d("visible",i.visibleEdit)("model",i.userForm)("fields",i.editFields),o(),P("subtitle","Confirmer la suppression de ",i.selectedUsers.length," utilisateurs?"),d("visible",i.visibleDelete))},dependencies:[le,B,Q,ie,G,W,O,N,J,X,Y,Z,ee,te,$,K,H,z,re,ne],encapsulation:2});let s=a;return s})();export{De as AdminPage};
